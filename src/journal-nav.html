<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/iron-signals/iron-signals.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="journal-entry.html">

<dom-module id="journal-nav">
  <template>

    <iron-signals on-iron-signal-load-data="listenJournalData"></iron-signals>

    <google-map
      map="{{map}}"
      zoom="3"
      latitude="-29.537951"
      longitude="161.497693"
      map-type="satellite"
      disable-default-ui="true"
      api-key="AIzaSyCEowUZnnaTudIOq3XYaQLgVD0lOr-Bn1A">
      <template is="dom-repeat" items="{{entries}}" as="entry">
        <google-map-marker
          id="marker.{{index}}"
          latitude="{{entry.coordinates.latitude}}"
          longitude="{{entry.coordinates.longitude}}"
          click-events="true"
          animation=""
          on-google-map-marker-click="clickMarker">
        </google-map-marker>
      </template>
    </google-map>

    <div style="display:flex; justify-content:space-around;">
      <paper-button on-click="clickPrev">Prev</paper-button>
      <paper-button on-click="currentLocation">Current Location</paper-button>
      <!-- <div>No marker</div> -->
      <paper-button on-click="clickNext">Next</paper-button>
    </div>

    <journal-entry></journal-entry>

  </template>
  <script>

  Polymer({
    is: 'journal-nav',

    properties: {

      index: {
        type: Number,
        value: 250
      },

      entries: {
        type: Object
      }
    },

    listenJournalData: function(e) {
      this.entries = e.detail;
      this.currentEntry(this.index);
    },

    clickNext: function() {
      if (this.index < 1049) {
        this.index++;
        this.currentEntry(this.index);
      } else {
        this.index = 0;
        this.currentEntry(this.index);
      };
    },

    clickPrev: function() {
      if ((this.index > 0) && (this.index <= 1049)) {
        this.index--;
        this.currentEntry(this.index);
      } else {
        this.index = 1049;
        this.currentEntry(this.index);
      };
    },

    clickMarker: function(e) {
      var mapClick = e.model.__data__;
      this.index = mapClick.index;
      this.currentEntry(this.index);
    },

    currentLocation: function() {
      this.currentEntry(this.index);
    },

    currentEntry: function(num) {
      this.loadEntry(this.entries[num]);
      var currentMarker = document.getElementById("marker."+num);
      function bounceMarker() {
        currentMarker.setAttribute("animation", "BOUNCE");
        setTimeout(function() {
          currentMarker.setAttribute("animation", "");
        }, 2100);
      };
      bounceMarker();

    },

    loadEntry: function(obj) {
      this.fire('iron-signal', {name: 'send-data', data: obj});
    }

  });

  </script>
</dom-module>
