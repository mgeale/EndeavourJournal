<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/iron-signals/iron-signals.html">

<dom-module id="journal-nav">
  <template>

    <iron-signals on-iron-signal-loaded-data="listenJournalData"></iron-signals>

    <google-map
      map="{{map}}"
      zoom="5"
      latitude="50.351557"
      longitude="-4.146181"
      map-type="satellite"
      fitToMarkers
      api-key="AIzaSyB0a_VCfYtnevVSlcm3CWUL3PkAt5W6VKA">
      <template is="dom-repeat" items="{{dates}}" as="date">
        <google-map-marker
          latitude="{{date.coordinates.latitude}}"
          longitude="{{date.coordinates.longitude}}"
          click-events="true"
          on-google-map-marker-click="clickMarker">
        </google-map-marker>
      </template>
    </google-map>

    <button on-click="clickPrev">Prev</button><button on-click="clickNext">Next</button>
    <h2> Entry: {{index}} <br>Date: {{dateObj}}</h2>

  </template>
  <script>

  Polymer({
    is: 'journal-nav',

    properties: {

      index: {
        type: Number,
        value: 0
      },

      dates: {
        type: Object
      },

      dateObj: {
        type: String
      }
    },

    listenJournalData: function(e) {
      this.dates = e.detail;
    },

    clickNext: function(e) {
      if (this.index < this.dates.length) {
        this.loadEntry(this.dates[this.index]);
        this.dateObj = this.dates[this.index].date;
        this.index++;
      };
    },

    clickPrev: function() {
      if (this.index < this.dates.length) {
        this.index--;
        this.loadEntry(this.dates[this.index]);
        this.dateObj = this.dates[this.index].date;
      };

    },

    clickMarker: function(e) {
      this.loadEntry(e.model.__data__.date);
      this.index = e.model.__data__.index;
      this.dateObj = e.model.__data__.date.date;
    },

    loadEntry: function(obj) {
      this.fire('iron-signal', {name: 'send-data', data: obj});
    }

  });

  </script>
</dom-module>
