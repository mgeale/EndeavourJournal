<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<dom-module id="journal-entry">
  <template>

    <iron-signals on-iron-signal-send-data="listenJournalEntry"></iron-signals>
    <div><paper-spinner active></paper-spinner></div>
    <paper-card>
      <div class="card-content">
        <div style="display:flex; justify-content:center;"><h2>{{date}} {{date2}}</h2></div>
        <div id="content"></div>
      </div>
    </paper-card>


  </template>

  <script>

  Polymer({
    is: "journal-entry",

    properties: {

      entry: {
        type: String
      },

      date: {
        type: String
      },

      date2: {
        type: String
      },

      days: {
        type: String
      }

    },

    listenJournalEntry: function(e) {
      var item = this.$$('#content');
      var spinner = this.$$('paper-spinner');
      this.entry = e.detail.filename;
      spinner.removeAttribute("active");
      this.importHref('../data/journal-pages/' + this.entry, function(e) {
        item.innerHTML = e.path[0].import.body.innerHTML;
      });
      var startDate = new Date(1768,07,28);
      var splitDate = e.detail.date.split("-");
      var entryDate = new Date(splitDate[0], splitDate[1] -1, splitDate[2]);
      this.days = this.calDays(startDate, entryDate);
      this.date = this.formatDate(entryDate);
    },

    calDays: function(startDate, entryDate) {
      var oneDay = 24*60*60*1000;
      return Math.round(Math.abs((startDate.getTime() - entryDate.getTime())/(oneDay)));
    },

    formatDate: function(date) {
      var monthNames = [
        "January", "February", "March",
        "April", "May", "June", "July",
        "August", "September", "October",
        "November", "December"
      ];

      var day = date.getDate();
      var monthIndex = date.getMonth();
      var year = date.getFullYear();

      return day + ' ' + monthNames[monthIndex] + ' ' + year;
    }

  });

  </script>
</dom-module>
